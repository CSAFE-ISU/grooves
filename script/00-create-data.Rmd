---
title: "Untitled"
output: html_document
---

```{r}
#devtools::install_github("heike/bulletxtrctr") ## Latest commit 1b387df 
#devtools::install_github("nategarton13/bulletcp") ## Latest commit 6f949ac

library(bulletxtrctr)
library(tidyr)
library(purrr)
library(dplyr)
library(ggplot2)
```

```{r}
hamby44 <- readRDS("../data/hamby44/hamby44_eval.rda")
#hamby44 <- hamby44 %>% filter(!is.na(crosscuts))
```

```{r}
hamby44 <- hamby44 %>% select(c(source, barrel, bullet, land, PARTITION_ID, crosscuts, ccdata_w_resid, left_groove, right_groove))
head(hamby44)

hamby44 <- hamby44 %>% mutate(ccdata = purrr::map(ccdata_w_resid, .f = function(land){
  new_land <- data.frame(x = land$x, value = land$value)
  return(new_land)
}))
```

```{r}
hamby44 <- hamby44 %>% mutate(grooves_rollapply = purrr::map(ccdata, .f = function(land){
  bulletxtrctr::get_grooves_rollapply(x = land$x, value = land$value, return_plot = F)
}))

hamby44 <- hamby44 %>% mutate(grooves_lassobasic = purrr::map(ccdata, .f = function(land){
  bulletxtrctr::get_grooves_lasso(x = land$x, value = land$value, lasso_method = "basic", return_plot = F)
  }))

hamby44 <- hamby44 %>% mutate(grooves_lassofull = purrr::map(ccdata, .f = function(land){
  bulletxtrctr::get_grooves_lasso(x = land$x, value = land$value, lasso_method = "full", return_plot = F)
  }))

tst <- hamby44[1:3,] %>% mutate(grooves_bcp = purrr::map(ccdata, .f = function(land){
  bulletcp::get_grooves_bcp(x = land$x, value = land$value, adjust = 10)
  }))


head(tst)
```
